<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ForexPro Trading Platform</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Header with navigation -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-chart-line"></i>
            <span>ForexPro</span>
        </div>
        <nav class="main-nav">
            <ul>
                <li class="active"><a href="#"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="#"><i class="fas fa-chart-area"></i> Charts</a></li>
                <li><a href="#"><i class="fas fa-history"></i> History</a></li>
                <li><a href="#"><i class="fas fa-cog"></i> Settings</a></li>
            </ul>
        </nav>
        <div class="user-controls">
            <div class="notifications">
                <i class="fas fa-bell"></i>
                <span class="badge">3</span>
            </div>
            <div class="settings-btn" id="settings-btn">
                <i class="fas fa-cog"></i>
            </div>
            <div class="user-profile">
                <img src="/api/placeholder/32/32" alt="User Profile" class="avatar">
                <span>Trader</span>
            </div>
        </div>
    </header>

    <!-- Main content area -->
    <div class="main-container">
        <!-- Sidebar with quick stats -->
        <aside class="sidebar">
            <div class="market-status">
                <div class="status-indicator active">
                    <span class="pulse"></span>
                    Markets Open
                </div>
                <div class="time-info">
                    <div class="current-time" id="current-time">10:30:45</div>
                    <div class="timezone">GMT+0</div>
                </div>
            </div>
            
            <div class="quick-links">
                <h4>Quick Access</h4>
                <ul>
                    <li><a href="#"><i class="fas fa-plus-circle"></i> New Trade</a></li>
                    <li><a href="#"><i class="fas fa-wallet"></i> Deposit Funds</a></li>
                    <li><a href="#"><i class="fas fa-exchange-alt"></i> Transfer</a></li>
                    <li><a href="#"><i class="fas fa-file-alt"></i> Reports</a></li>
                </ul>
            </div>
            
            <div class="market-indices">
                <h4>Market Indices</h4>
                <div class="index-item">
                    <span>S&P 500</span>
                    <span class="value up">4,589.25 <i class="fas fa-caret-up"></i></span>
                </div>
                <div class="index-item">
                    <span>NASDAQ</span>
                    <span class="value up">14,356.78 <i class="fas fa-caret-up"></i></span>
                </div>
                <div class="index-item">
                    <span>DOW</span>
                    <span class="value down">34,589.50 <i class="fas fa-caret-down"></i></span>
                </div>
            </div>
        </aside>

        <!-- Main content -->
        <div class="content-area">
            <!-- Dashboard heading with search -->
            <div class="dashboard-header">
                <div class="page-title">
                    <h1>Trading Dashboard</h1>
                    <p class="subtitle">Market overview and portfolio management</p>
                </div>
                
                <!-- Enhanced Search Bar -->
                <div class="search-container">
                    <div class="search-wrapper">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="forex-search" placeholder="Search currency pairs...">
                        <button id="clear-search" class="clear-search"><i class="fas fa-times"></i></button>
                    </div>
                </div>
            </div>

            <!-- Portfolio Overview Section -->
            <section class="portfolio-summary">
                <div class="card-header">
                    <h2><i class="fas fa-briefcase"></i> Portfolio Overview</h2>
                    <div class="header-actions">
                        <select id="time-period">
                            <option value="day">Day</option>
                            <option value="week" selected>Week</option>
                            <option value="month">Month</option>
                            <option value="year">Year</option>
                        </select>
                        <div class="refresh-button" id="refresh-portfolio">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="portfolio-time">
                            Updated: <span id="last-update">Just now</span>
                        </div>
                    </div>
                </div>
                
                <div class="portfolio-stats">
                    <div class="stat-card main-balance">
                        <div class="stat-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Available Balance</span>
                            <span id="available-balance" class="stat-value">$10,000.00</span>
                            <span class="stat-change positive" id="balance-change">+0.00% <i class="fas fa-caret-up"></i></span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Total Profit/Loss</span>
                            <span id="total-pnl" class="stat-value">$0.00</span>
                            <div class="stat-details">
                                <span class="stat-period">24h Change</span>
                                <div class="mini-chart">
                                    <div class="chart-bar"></div>
                                    <div class="chart-bar"></div>
                                    <div class="chart-bar"></div>
                                    <div class="chart-bar"></div>
                                    <div class="chart-bar"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Active Positions</span>
                            <span id="position-count" class="stat-value">0</span>
                            <span class="stat-period">Total Value: <span class="highlighted">$<span id="positions-value">0.00</span></span></span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Trading Summary</span>
                            <div class="mini-stats">
                                <div class="mini-stat">
                                    <span class="mini-label">Win Rate</span>
                                    <span class="mini-value">0%</span>
                                </div>
                                <div class="mini-stat">
                                    <span class="mini-label">Risk Ratio</span>
                                    <span class="mini-value">0:0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Positions and Forex Sections in Grid Layout -->
            <div class="trading-dashboard-grid">
                <!-- Open Positions Section -->
                <section class="positions-container card">
                    <div class="card-header">
                        <h2><i class="fas fa-layer-group"></i> Open Positions</h2>
                        <div class="positions-filters">
                            <button class="filter-btn active" data-filter="all">All</button>
                            <button class="filter-btn" data-filter="buy">Buy</button>
                            <button class="filter-btn" data-filter="sell">Sell</button>
                        </div>
                    </div>
                    
                    <div class="positions-list" id="open-positions">
                        <!-- Position items will be populated here -->
                        <div class="empty-state">
                            <i class="fas fa-folder-open"></i>
                            <p>No open positions yet</p>
                            <button class="btn-primary">Create Your First Trade</button>
                        </div>
                    </div>
                </section>

                <!-- Forex Pairs Section -->
                <section class="forex-container card">
                    <div class="card-header">
                        <h2><i class="fas fa-globe"></i> Forex Pairs</h2>
                        <div class="header-actions">
                            <select id="sort-by">
                                <option value="name">Name</option>
                                <option value="value">Value</option>
                                <option value="change">% Change</option>
                            </select>
                            <div class="view-toggle">
                                <button class="view-btn active" data-view="grid"><i class="fas fa-th"></i></button>
                                <button class="view-btn" data-view="list"><i class="fas fa-list"></i></button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="forex-pairs" class="forex-grid">
                        <!-- Forex pairs will be populated here -->
                    </div>
                </section>
            </div>

            <!-- Market Analysis Section -->
            <section class="market-analysis card">
                <div class="card-header">
                    <h2><i class="fas fa-chart-bar"></i> Market Analysis</h2>
                    <div class="header-actions">
                        <select id="timeframe">
                            <option value="1D">1 Day</option>
                            <option value="1W" selected>1 Week</option>
                            <option value="1M">1 Month</option>
                        </select>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="market-chart" height="250"></canvas>
                </div>
            </section>
        </div>
    </div>

    <!-- Trading Modal -->
    <div id="trading-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Trade <span id="selected-pair"></span></h3>
                <button class="close"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="modal-body">
                <div class="pair-info">
                    <div class="pair-rate">
                        <span id="modal-rate">1.2345</span>
                        <span class="rate-change positive">+0.05% <i class="fas fa-caret-up"></i></span>
                    </div>
                    <div class="bid-ask">
                        <div class="bid">
                            <span class="label">Bid</span>
                            <span class="value">1.2340</span>
                        </div>
                        <div class="ask">
                            <span class="label">Ask</span>
                            <span class="value">1.2350</span>
                        </div>
                    </div>
                </div>
                
                <div class="trade-form">
                    <div class="form-group">
                        <label for="trade-type">Trade Type</label>
                        <div class="trade-type-toggle">
                            <button class="trade-btn buy active" data-type="buy">Buy</button>
                            <button class="trade-btn sell" data-type="sell">Sell</button>
                            <input type="hidden" id="trade-type" value="buy">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="trade-amount">Amount ($)</label>
                        <div class="amount-input">
                            <input type="number" id="trade-amount" placeholder="Enter amount">
                            <div class="amount-presets">
                                <button data-amount="100">$100</button>
                                <button data-amount="500">$500</button>
                                <button data-amount="1000">$1000</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="trade-leverage">Leverage</label>
                        <select id="trade-leverage">
                            <option value="1">1:1</option>
                            <option value="5">1:5</option>
                            <option value="10" selected>1:10</option>
                            <option value="20">1:20</option>
                            <option value="50">1:50</option>
                        </select>
                    </div>
                    
                    <div class="order-details">
                        <div class="detail-item">
                            <span class="detail-label">Pip Value</span>
                            <span class="detail-value">$0.10</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Margin Required</span>
                            <span class="detail-value">$100.00</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Commission</span>
                            <span class="detail-value">$0.50</span>
                        </div>
                    </div>
                    
                    <div class="risk-management">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="use-stop-loss"> 
                                Stop Loss
                            </label>
                            <input type="number" id="stop-loss" placeholder="0.0000" disabled>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="use-take-profit"> 
                                Take Profit
                            </label>
                            <input type="number" id="take-profit" placeholder="0.0000" disabled>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <div class="trade-summary">
                    <span>Total: $<span id="trade-total">0.00</span></span>
                </div>
                <div class="action-buttons">
                    <button class="btn-secondary" id="cancel-trade">Cancel</button>
                    <button class="btn-primary" id="execute-trade">Execute Trade</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> Settings</h3>
                <button class="close" id="close-settings"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="modal-body">
                <div class="settings-section">
                    <h4>Appearance</h4>
                    <div class="form-group">
                        <label for="theme-select">Theme</label>
                        <select id="theme-select">
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                            <option value="auto">Auto (System)</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>Trading Preferences</h4>
                    <div class="form-group">
                        <label for="default-leverage">Default Leverage</label>
                        <select id="default-leverage">
                            <option value="1">1:1</option>
                            <option value="5">1:5</option>
                            <option value="10">1:10</option>
                            <option value="20">1:20</option>
                            <option value="50">1:50</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="default-amount">Default Trade Amount ($)</label>
                        <input type="number" id="default-amount" placeholder="1000">
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>Notifications</h4>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enable-notifications" checked>
                            Enable Notifications
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="sound-alerts">
                            Sound Alerts
                        </label>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>Data & Updates</h4>
                    <div class="form-group">
                        <label for="update-interval">Auto Update Interval</label>
                        <select id="update-interval">
                            <option value="30">30 seconds</option>
                            <option value="60" selected>1 minute</option>
                            <option value="300">5 minutes</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <div class="action-buttons">
                    <button class="btn-secondary" id="reset-settings">Reset to Default</button>
                    <button class="btn-primary" id="save-settings">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // API key
    const API_KEY = 'cur_live_ZqHv9dd95IrnJy35YezXhDDeChGD3wxk7F0DS4ov';
    
    // Global variables
    let userPortfolio;
    let userSettings;
    let allForexPairs = []; // Store all forex pairs
    let marketChart = null;
    let selectedChartPair = null;
    let selectedChartValue = 1.0;

    // Load portfolio from localStorage
    function loadPortfolio() {
        const savedPortfolio = localStorage.getItem('forexPortfolio');
        return savedPortfolio ? JSON.parse(savedPortfolio) : {
            balance: 10000,
            positions: [],
            totalPnL: 0
        };
    }

    // Save portfolio to localStorage
    function savePortfolio() {
        localStorage.setItem('forexPortfolio', JSON.stringify(userPortfolio));
    }

    // Load settings from localStorage
    function loadSettings() {
        const savedSettings = localStorage.getItem('forexSettings');
        return savedSettings ? JSON.parse(savedSettings) : {
            theme: 'light',
            defaultLeverage: 10,
            defaultAmount: 1000,
            enableNotifications: true,
            soundAlerts: false,
            updateInterval: 60
        };
    }

    // Save settings to localStorage
    function saveSettings() {
        localStorage.setItem('forexSettings', JSON.stringify(userSettings));
    }

    // Apply settings to the UI
    function applySettings() {
        // Apply theme
        document.body.className = userSettings.theme;
        
        // Apply default values to trade modal (if elements exist)
        const tradeLeverage = document.getElementById('trade-leverage');
        const tradeAmount = document.getElementById('trade-amount');
        if (tradeLeverage) tradeLeverage.value = userSettings.defaultLeverage;
        if (tradeAmount) tradeAmount.placeholder = userSettings.defaultAmount;
        
        // Apply update interval
        if (window.updateInterval) clearInterval(window.updateInterval);
        window.updateInterval = setInterval(updateProfitLoss, userSettings.updateInterval * 1000);
    }

    // Calculate profit/loss for a position
    function calculatePositionPnL(position, currentRate) {
        const multiplier = position.type === 'buy' ? 1 : -1;
        return position.amount * multiplier * (currentRate - position.openRate) / position.openRate;
    }

    // Show notification
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        
        // Set icon based on notification type
        let icon = 'info-circle';
        if (type === 'success') icon = 'check-circle';
        if (type === 'error') icon = 'exclamation-circle';
        
        notification.innerHTML = `
            <i class="fas fa-${icon}"></i>
            <span>${message}</span>
        `;
        
        document.body.appendChild(notification);
        
        // Show notification with animation
        setTimeout(() => notification.classList.add('show'), 10);
        
        // Remove after delay
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // Fetch forex pairs and update UI
    async function fetchForexPairs() {
        try {
            const response = await fetch('https://api.currencyapi.com/v3/latest', {
                headers: {
                    'apikey': API_KEY
                }
            });
            const data = await response.json();
            displayForexPairs(data.data);
        } catch (error) {
            console.error('Error fetching forex data:', error);
            showNotification('Failed to load currency data', 'error');
            // Fallback to simulated data
            const simulatedData = {
                'EUR': { value: 1.0850 },
                'GBP': { value: 1.2650 },
                'JPY': { value: 0.0067 },
                'AUD': { value: 0.6580 },
                'CAD': { value: 0.7380 },
                'CHF': { value: 1.1250 },
                'CNY': { value: 0.1380 },
                'NZD': { value: 0.6120 }
            };
            displayForexPairs(simulatedData);
        }
    }

    // Display forex pairs
    function displayForexPairs(pairs) {
        allForexPairs = pairs; // Store all pairs for search
        filterForexPairs(''); // Display all pairs initially
    }

    // Search functionality
    function initializeSearch() {
        const searchInput = document.getElementById('forex-search');
        const clearButton = document.getElementById('clear-search');

        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            filterForexPairs(searchTerm);
            toggleClearButton(searchTerm);
        });

        clearButton.addEventListener('click', () => {
            searchInput.value = '';
            filterForexPairs('');
            toggleClearButton('');
        });
    }

    function toggleClearButton(searchTerm) {
        const clearButton = document.getElementById('clear-search');
        clearButton.style.display = searchTerm ? 'flex' : 'none';
    }

    function filterForexPairs(searchTerm) {
        const container = document.getElementById('forex-pairs');
        container.innerHTML = '';
        
        const filteredPairs = Object.entries(allForexPairs).filter(([currency, rate]) => 
            currency.toLowerCase().includes(searchTerm)
        );

        if (filteredPairs.length === 0) {
            container.innerHTML = `
                <div class="empty-search">
                    <i class="fas fa-search"></i>
                    <p>No currency pairs match your search</p>
                </div>
            `;
            return;
        }

        filteredPairs.forEach(([currency, rate]) => {
            const changePercent = ((rate.value - 1) * 100).toFixed(2);
            const trendClass = rate.value >= 1 ? 'trend-up' : 'trend-down';
            const changeIcon = rate.value >= 1 ? 
                '<i class="fas fa-caret-up"></i>' : '<i class="fas fa-caret-down"></i>';
            
            const pairDiv = document.createElement('div');
            pairDiv.className = 'forex-pair';
            pairDiv.innerHTML = `
                <div class="pair-header">
                    <div class="pair-name">
                        <h3>${currency}/USD</h3>
                        <span class="pair-tag">Forex</span>
                    </div>
                    <div class="pair-actions">
                        <button class="btn-icon favorite"><i class="far fa-star"></i></button>
                        <button class="btn-icon more"><i class="fas fa-ellipsis-v"></i></button>
                    </div>
                </div>
                <div class="pair-rate">
                    <span class="rate-value">${rate.value.toFixed(4)}</span>
                    <span class="rate-change ${trendClass}">${changePercent}% ${changeIcon}</span>
                </div>
                <div class="pair-stats">
                    <div class="stat">
                        <span class="stat-label">24h High</span>
                        <span class="stat-value">${(rate.value * 1.01).toFixed(4)}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">24h Low</span>
                        <span class="stat-value">${(rate.value * 0.99).toFixed(4)}</span>
                    </div>
                </div>
                <div class="pair-trading-buttons">
                    <button class="trade-button buy" onclick="quickBuy('${currency}/USD', ${rate.value})">
                        <i class="fas fa-arrow-up"></i> Buy
                </button>
                    <button class="trade-button sell" onclick="quickSell('${currency}/USD', ${rate.value})">
                        <i class="fas fa-arrow-down"></i> Sell
                    </button>
                    <button class="trade-button advanced" onclick="openTradeModal('${currency}', ${rate.value})">
                        <i class="fas fa-cog"></i> Advanced
                    </button>
                </div>
            `;
            container.appendChild(pairDiv);
        });
        
        // Add event listeners for favorite buttons
        document.querySelectorAll('.favorite').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const icon = btn.querySelector('i');
                if (icon.classList.contains('far')) {
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    showNotification('Added to favorites', 'success');
                } else {
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    showNotification('Removed from favorites', 'info');
                }
            });
        });
    }

    // Update profit/loss calculations
    async function updateProfitLoss() {
        try {
            const response = await fetch('https://api.currencyapi.com/v3/latest', {
                headers: {
                    'apikey': API_KEY
                }
            });
            const data = await response.json();
            
            let totalPnL = 0;
            let closedPositions = [];
            userPortfolio.positions.forEach((position, idx) => {
                const currentRate = data.data[position.pair.split('/')[0]].value;
                const multiplier = position.type === 'buy' ? 1 : -1;
                const positionPnL = position.amount * multiplier * (currentRate - position.openRate) / position.openRate * (position.leverage || 1);
                position.currentPnL = positionPnL; // Store current P/L for each position
                totalPnL += positionPnL;
                // Check stop loss
                if (position.stopLoss && (
                    (position.type === 'buy' && currentRate <= position.stopLoss) ||
                    (position.type === 'sell' && currentRate >= position.stopLoss)
                )) {
                    closedPositions.push({idx, reason: 'Stop Loss', pnl: positionPnL});
                }
                // Check take profit
                if (position.takeProfit && (
                    (position.type === 'buy' && currentRate >= position.takeProfit) ||
                    (position.type === 'sell' && currentRate <= position.takeProfit)
                )) {
                    closedPositions.push({idx, reason: 'Take Profit', pnl: positionPnL});
                }
            });
            // Remove closed positions
            closedPositions.reverse().forEach(({idx, reason, pnl}) => {
                userPortfolio.balance += userPortfolio.positions[idx].amount + pnl;
                showNotification(`Position closed by ${reason} with ${pnl >= 0 ? 'profit' : 'loss'} of $${Math.abs(pnl).toFixed(2)}`, pnl >= 0 ? 'success' : 'info');
                userPortfolio.positions.splice(idx, 1);
            });
            userPortfolio.totalPnL = totalPnL;
            updatePortfolioDisplay();
            savePortfolio();
            // Update last updated time
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
            // Animate refresh button
            const refreshBtn = document.getElementById('refresh-portfolio');
            refreshBtn.classList.add('spinning');
            setTimeout(() => refreshBtn.classList.remove('spinning'), 1000);
        } catch (error) {
            console.error('Error updating P/L:', error);
            showNotification('Error updating data. Please try again.', 'error');
        }
    }

    // Update mini chart based on P/L trend
    function updateMiniChart(totalPnL) {
        const chartBars = document.querySelectorAll('.mini-chart .chart-bar');
        
        // Generate random data for demonstration
        const barHeights = [40, 65, 30, 80, 55];
        
        chartBars.forEach((bar, i) => {
            const height = barHeights[i];
            bar.style.height = `${height}%`;
            
            // Alternate colors for visualization
            if (totalPnL >= 0) {
                bar.className = 'chart-bar positive';
            } else {
                bar.className = 'chart-bar negative';
            }
        });
    }

    // Open trading modal with enhanced data
    function openTradeModal(pair, rate) {
        const modal = document.getElementById('trading-modal');
        if (!modal) return;
        
        document.getElementById('selected-pair').textContent = `${pair}/USD`;
        document.getElementById('modal-rate').textContent = rate.toFixed(4);
        
        // Set bid and ask prices (simulated spread)
        const spread = 0.0010;
        const bidPrice = (rate - spread/2).toFixed(4);
        const askPrice = (rate + spread/2).toFixed(4);
        
        document.querySelector('.bid .value').textContent = bidPrice;
        document.querySelector('.ask .value').textContent = askPrice;
        
        // Reset form values
        document.getElementById('trade-amount').value = '';
        document.getElementById('trade-type').value = 'buy';
        document.getElementById('trade-leverage').value = userSettings.defaultLeverage || 10;
        document.getElementById('use-stop-loss').checked = false;
        document.getElementById('use-take-profit').checked = false;
        document.getElementById('stop-loss').disabled = true;
        document.getElementById('take-profit').disabled = true;
        
        // Reset UI states
        document.querySelectorAll('.trade-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector('.trade-btn.buy').classList.add('active');
        
        modal.style.display = 'block';
        
        // Add fade-in effect
        setTimeout(() => modal.classList.add('visible'), 10);
        
        // Calculate and update trade details
        updateTradeCalculations();
    }

    // Update trade calculations
    function updateTradeCalculations() {
        const amount = parseFloat(document.getElementById('trade-amount').value) || 0;
        const leverage = parseInt(document.getElementById('trade-leverage').value) || 1;
        const rate = parseFloat(document.getElementById('modal-rate').textContent) || 1;
        const tradeType = document.getElementById('trade-type').value;
        const useStopLoss = document.getElementById('use-stop-loss').checked;
        const useTakeProfit = document.getElementById('use-take-profit').checked;
        const stopLoss = useStopLoss ? parseFloat(document.getElementById('stop-loss').value) : null;
        const takeProfit = useTakeProfit ? parseFloat(document.getElementById('take-profit').value) : null;
        
        // Update pip value (simulated)
        const pipValue = (amount * 0.0001 * leverage).toFixed(2);
        const pipValueElement = document.querySelector('.detail-item:nth-child(1) .detail-value');
        if (pipValueElement) pipValueElement.textContent = `$${pipValue}`;
        
        // Update margin required
        const margin = (amount / leverage).toFixed(2);
        const marginElement = document.querySelector('.detail-item:nth-child(2) .detail-value');
        if (marginElement) marginElement.textContent = `$${margin}`;
        
        // Update commission (simulated as 0.5% of amount)
        const commission = (amount * 0.005).toFixed(2);
        const commissionElement = document.querySelector('.detail-item:nth-child(3) .detail-value');
        if (commissionElement) commissionElement.textContent = `$${commission}`;
        
        // Calculate potential profit/loss for stop loss and take profit
        let stopLossPips = 0;
        let takeProfitPips = 0;
        
        if (stopLoss && tradeType === 'buy') {
            stopLossPips = (rate - stopLoss) * 10000; // Convert to pips
        } else if (stopLoss && tradeType === 'sell') {
            stopLossPips = (stopLoss - rate) * 10000;
        }
        
        if (takeProfit && tradeType === 'buy') {
            takeProfitPips = (takeProfit - rate) * 10000;
        } else if (takeProfit && tradeType === 'sell') {
            takeProfitPips = (rate - takeProfit) * 10000;
        }
        
        // Calculate potential P/L
        const stopLossPL = stopLossPips * (amount * leverage) * 0.0001;
        const takeProfitPL = takeProfitPips * (amount * leverage) * 0.0001;
        
        // Update total
        const total = amount;
        const totalElement = document.getElementById('trade-total');
        if (totalElement) totalElement.textContent = total.toFixed(2);
        
        // Update trade summary with risk/reward info
        const tradeSummary = document.querySelector('.trade-summary');
        if (tradeSummary) {
            let summaryText = `Total: $${total.toFixed(2)}`;
            if (useStopLoss) {
                summaryText += ` | Risk: $${Math.abs(stopLossPL).toFixed(2)}`;
            }
            if (useTakeProfit) {
                summaryText += ` | Reward: $${Math.abs(takeProfitPL).toFixed(2)}`;
            }
            if (useStopLoss && useTakeProfit) {
                const riskRewardRatio = Math.abs(takeProfitPL / stopLossPL);
                summaryText += ` | R:R ${riskRewardRatio.toFixed(2)}:1`;
            }
            tradeSummary.textContent = summaryText;
        }
        
        // Update execute button state
        const executeBtn = document.getElementById('execute-trade');
        if (executeBtn) {
            const isValid = amount > 0 && amount <= userPortfolio.balance;
            executeBtn.disabled = !isValid;
            executeBtn.style.opacity = isValid ? '1' : '0.5';
        }
    }

    // Execute trade with animation
    function executeTrade() {
        const tradeType = document.getElementById('trade-type').value;
        const amount = parseFloat(document.getElementById('trade-amount').value);
        const pairInfo = document.getElementById('selected-pair').textContent;
        const pair = pairInfo;
        const rate = parseFloat(document.getElementById('modal-rate').textContent);
        const leverage = parseInt(document.getElementById('trade-leverage').value) || 1;
        const useStopLoss = document.getElementById('use-stop-loss').checked;
        const useTakeProfit = document.getElementById('use-take-profit').checked;
        const stopLoss = useStopLoss ? parseFloat(document.getElementById('stop-loss').value) : null;
        const takeProfit = useTakeProfit ? parseFloat(document.getElementById('take-profit').value) : null;
        
        if (isNaN(amount) || amount <= 0) {
            showNotification('Please enter a valid amount!', 'error');
            return;
        }
        
        if (amount > userPortfolio.balance) {
            showNotification('Insufficient funds!', 'error');
            return;
        }

        // Add loading indication
        const executeBtn = document.getElementById('execute-trade');
        executeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        executeBtn.disabled = true;
        
        // Simulate processing time
        setTimeout(() => {
            // Update portfolio
            userPortfolio.balance -= amount;
            userPortfolio.positions.push({
                pair: pair,
                type: tradeType,
                amount: amount,
                leverage: leverage,
                openRate: rate,
                currentPnL: 0,
                timestamp: new Date().getTime(),
                stopLoss: stopLoss,
                takeProfit: takeProfit
            });

            savePortfolio();
            updatePortfolioDisplay();
            
            const modal = document.getElementById('trading-modal');
            modal.classList.remove('visible');
            setTimeout(() => modal.style.display = 'none', 300);
            
            showNotification(`Successfully opened ${tradeType} position for ${pair}` +
                (stopLoss ? ` | SL: ${stopLoss}` : '') + (takeProfit ? ` | TP: ${takeProfit}` : ''), 'success');
            
            // Reset button state
            executeBtn.innerHTML = 'Execute Trade';
            executeBtn.disabled = false;
        }, 1500);
    }

    // Buy forex function
    function buyForex(pair, rate, amount = null) {
        if (!amount) {
            amount = userSettings.defaultAmount || 1000;
        }
        
        if (amount > userPortfolio.balance) {
            showNotification('Insufficient funds for this trade!', 'error');
            return;
        }

        // Open trade modal with buy preset
        openTradeModal(pair, rate);
        
        // Set trade type to buy
        document.getElementById('trade-type').value = 'buy';
        document.querySelectorAll('.trade-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector('.trade-btn.buy').classList.add('active');
        
        // Set amount if provided
        if (amount) {
            document.getElementById('trade-amount').value = amount;
            updateTradeCalculations();
        }
    }

    // Sell forex function
    function sellForex(pair, rate, amount = null) {
        if (!amount) {
            amount = userSettings.defaultAmount || 1000;
        }
        
        if (amount > userPortfolio.balance) {
            showNotification('Insufficient funds for this trade!', 'error');
            return;
        }

        // Open trade modal with sell preset
        openTradeModal(pair, rate);
        
        // Set trade type to sell
        document.getElementById('trade-type').value = 'sell';
        document.querySelectorAll('.trade-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector('.trade-btn.sell').classList.add('active');
        
        // Set amount if provided
        if (amount) {
            document.getElementById('trade-amount').value = amount;
            updateTradeCalculations();
        }
    }

    // Quick buy function (direct execution without modal)
    function quickBuy(pair, rate, amount = null) {
        console.log('quickBuy called:', { pair, rate, amount });
        
        if (!amount) {
            amount = userSettings.defaultAmount || 1000;
        }
        
        console.log('Final amount:', amount, 'Balance:', userPortfolio.balance);
        
        if (amount > userPortfolio.balance) {
            showNotification('Insufficient funds for this trade!', 'error');
            return;
        }

        // Show confirmation dialog
        const confirmTrade = confirm(`Confirm BUY order:\nPair: ${pair}\nAmount: $${amount.toFixed(2)}\nRate: ${rate.toFixed(4)}\n\nDo you want to proceed?`);
        
        if (!confirmTrade) {
            showNotification('Trade cancelled', 'info');
            return;
        }

        // Add loading indication
        showNotification('Processing buy order...', 'info');
        
        // Simulate processing time
        setTimeout(() => {
            console.log('Executing buy trade...');
            
            // Update portfolio
            const oldBalance = userPortfolio.balance;
            userPortfolio.balance -= amount;
            
            const newPosition = {
                pair: pair,
                type: 'buy',
                amount: amount,
                leverage: userSettings.defaultLeverage || 1,
                openRate: rate,
                currentPnL: 0,
                timestamp: new Date().getTime(),
                stopLoss: null,
                takeProfit: null
            };
            
            userPortfolio.positions.push(newPosition);

            console.log('Portfolio updated:', {
                oldBalance,
                newBalance: userPortfolio.balance,
                positions: userPortfolio.positions.length,
                newPosition
            });

            savePortfolio();
            updatePortfolioDisplay();
            
            showNotification(`✅ Successfully bought ${pair} for $${amount.toFixed(2)} at ${rate.toFixed(4)}`, 'success');
        }, 1000);
    }

    // Quick sell function (direct execution without modal)
    function quickSell(pair, rate, amount = null) {
        console.log('quickSell called:', { pair, rate, amount });
        
        if (!amount) {
            amount = userSettings.defaultAmount || 1000;
        }
        
        console.log('Final amount:', amount, 'Balance:', userPortfolio.balance);
        
        if (amount > userPortfolio.balance) {
            showNotification('Insufficient funds for this trade!', 'error');
            return;
        }

        // Show confirmation dialog
        const confirmTrade = confirm(`Confirm SELL order:\nPair: ${pair}\nAmount: $${amount.toFixed(2)}\nRate: ${rate.toFixed(4)}\n\nDo you want to proceed?`);
        
        if (!confirmTrade) {
            showNotification('Trade cancelled', 'info');
            return;
        }

        // Add loading indication
        showNotification('Processing sell order...', 'info');
        
        // Simulate processing time
        setTimeout(() => {
            console.log('Executing sell trade...');
            
            // Update portfolio
            const oldBalance = userPortfolio.balance;
            userPortfolio.balance -= amount;
            
            const newPosition = {
                pair: pair,
                type: 'sell',
                amount: amount,
                leverage: userSettings.defaultLeverage || 1,
                openRate: rate,
                currentPnL: 0,
                timestamp: new Date().getTime(),
                stopLoss: null,
                takeProfit: null
            };
            
            userPortfolio.positions.push(newPosition);

            console.log('Portfolio updated:', {
                oldBalance,
                newBalance: userPortfolio.balance,
                positions: userPortfolio.positions.length,
                newPosition
            });

            savePortfolio();
            updatePortfolioDisplay();
            
            showNotification(`✅ Successfully sold ${pair} for $${amount.toFixed(2)} at ${rate.toFixed(4)}`, 'success');
        }, 1000);
    }

    // Modified updatePortfolioDisplay function with enhanced UI
    function updatePortfolioDisplay() {
        const balanceElement = document.getElementById('available-balance');
        const pnlElement = document.getElementById('total-pnl');
        const positionCountElement = document.getElementById('position-count');
        const positionsValueElement = document.getElementById('positions-value');
        const lastUpdateElement = document.getElementById('last-update');
        
        if (balanceElement) balanceElement.textContent = `$${userPortfolio.balance.toFixed(2)}`;
        
        const totalPnL = userPortfolio.totalPnL;
        if (pnlElement) {
        pnlElement.textContent = `$${totalPnL.toFixed(2)}`;
        pnlElement.className = totalPnL >= 0 ? 'stat-value positive' : 'stat-value negative';
        }
        
        if (positionCountElement) positionCountElement.textContent = userPortfolio.positions.length;
        if (lastUpdateElement) lastUpdateElement.textContent = new Date().toLocaleTimeString();
        
        // Calculate total positions value
        const positionsValue = userPortfolio.positions.reduce((total, pos) => total + pos.amount, 0);
        if (positionsValueElement) positionsValueElement.textContent = positionsValue.toFixed(2);
        
        // Update mini chart bars based on P/L trend (simulated)
        updateMiniChart(totalPnL);
        
        // Update positions display
        const positionsContainer = document.getElementById('open-positions');
        if (!positionsContainer) return;
        
        if (userPortfolio.positions.length === 0) {
            positionsContainer.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-folder-open"></i>
                    <p>No open positions yet</p>
                    <button class="btn-primary">Create Your First Trade</button>
                </div>
            `;
            return;
        }
        
        positionsContainer.innerHTML = '';
        userPortfolio.positions.forEach((position, index) => {
            const pnlClass = position.currentPnL >= 0 ? 'positive' : 'negative';
            const pnlIcon = position.currentPnL >= 0 ? 
                '<i class="fas fa-caret-up"></i>' : '<i class="fas fa-caret-down"></i>';
            
            const positionDate = new Date(position.timestamp || Date.now()).toLocaleDateString();
            
            const posDiv = document.createElement('div');
            posDiv.className = 'position';
            posDiv.innerHTML = `
                <div class="position-info">
                    <div class="position-pair">
                        <span class="pair-name">${position.pair}</span>
                        <span class="position-type ${position.type}">${position.type.toUpperCase()}</span>
                    </div>
                    <div class="position-details">
                        <div class="detail">
                            <span class="detail-label">Amount</span>
                            <span class="detail-value">$${position.amount.toFixed(2)}</span>
                        </div>
                        <div class="detail">
                            <span class="detail-label">Open Rate</span>
                            <span class="detail-value">${position.openRate.toFixed(4)}</span>
                        </div>
                        <div class="detail">
                            <span class="detail-label">Leverage</span>
                            <span class="detail-value">${position.leverage || 1}x</span>
                        </div>
                        <div class="detail">
                            <span class="detail-label">Opened</span>
                            <span class="detail-value">${positionDate}</span>
                        </div>
                    </div>
                </div>
                <div class="position-pnl ${pnlClass}">
                    ${position.currentPnL >= 0 ? '+' : ''}$${Math.abs(position.currentPnL).toFixed(2)}
                    ${pnlIcon}
                </div>
                <div class="position-actions">
                    <button class="btn-outline-danger close-position" data-index="${index}">
                        Close
                    </button>
                </div>
            `;
            positionsContainer.appendChild(posDiv);
        });
        
        // Add event listeners for closing positions
        document.querySelectorAll('.close-position').forEach(btn => {
            btn.addEventListener('click', function() {
                const index = parseInt(this.getAttribute('data-index'));
                closePosition(index);
            });
        });
    }

    // Close a position
    function closePosition(index) {
        if (index < 0 || index >= userPortfolio.positions.length) return;
        
        const position = userPortfolio.positions[index];
        const profit = position.currentPnL || 0;
        
        // Return funds + profit/loss
        userPortfolio.balance += position.amount + profit;
        
        // Remove position
        userPortfolio.positions.splice(index, 1);
        
        // Update UI and save
        savePortfolio();
        updatePortfolioDisplay();
        
        showNotification(`Position closed with ${profit >= 0 ? 'profit' : 'loss'} of $${Math.abs(profit).toFixed(2)}`, 
            profit >= 0 ? 'success' : 'info');
    }

    // Get trend indicator class
    function getTrendClass(rate) {
        return rate > 1 ? 'trend-up' : 'trend-down';
    }

    // Initialize clock
    function updateClock() {
        const now = new Date();
        document.getElementById('current-time').textContent = now.toLocaleTimeString();
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize data
        userPortfolio = loadPortfolio();
        userSettings = loadSettings();
        
        // Apply settings on load
        applySettings();
        
        // Initialize search
        initializeSearch();
        
        // Fetch data
        fetchForexPairs();
        updateProfitLoss();
        
        // Set intervals for updates
        setInterval(fetchForexPairs, 60000); // Update forex pairs every minute
        setInterval(updateProfitLoss, userSettings.updateInterval * 1000); // Update P/L based on settings
        setInterval(updateClock, 1000); // Update clock every second
        
        // Initialize clock
        updateClock();
        
        // Bind event listeners
        bindEventListeners();
        
        // Show welcome notification
        setTimeout(() => {
            showNotification('Welcome to ForexPro Trading Platform', 'info');
        }, 1000);
    });

    // Bind event listeners
    function bindEventListeners() {
        // Settings modal
        document.getElementById('settings-btn').addEventListener('click', function() {
            const modal = document.getElementById('settings-modal');
            // Load current settings into form
            document.getElementById('theme-select').value = userSettings.theme;
            document.getElementById('default-leverage').value = userSettings.defaultLeverage;
            document.getElementById('default-amount').value = userSettings.defaultAmount;
            document.getElementById('enable-notifications').checked = userSettings.enableNotifications;
            document.getElementById('sound-alerts').checked = userSettings.soundAlerts;
            document.getElementById('update-interval').value = userSettings.updateInterval;
            
            modal.style.display = 'block';
            setTimeout(() => modal.classList.add('visible'), 10);
        });
        
        document.getElementById('close-settings').addEventListener('click', function() {
            const modal = document.getElementById('settings-modal');
            modal.classList.remove('visible');
            setTimeout(() => modal.style.display = 'none', 300);
        });
        
        document.getElementById('save-settings').addEventListener('click', function() {
            // Save settings from form
            userSettings.theme = document.getElementById('theme-select').value;
            userSettings.defaultLeverage = parseInt(document.getElementById('default-leverage').value);
            userSettings.defaultAmount = parseInt(document.getElementById('default-amount').value) || 1000;
            userSettings.enableNotifications = document.getElementById('enable-notifications').checked;
            userSettings.soundAlerts = document.getElementById('sound-alerts').checked;
            userSettings.updateInterval = parseInt(document.getElementById('update-interval').value);
            
            saveSettings();
            applySettings();
            
            const modal = document.getElementById('settings-modal');
            modal.classList.remove('visible');
            setTimeout(() => modal.style.display = 'none', 300);
            
            showNotification('Settings saved successfully!', 'success');
        });
        
        document.getElementById('reset-settings').addEventListener('click', function() {
            if (confirm('Are you sure you want to reset all settings to default?')) {
                userSettings = {
                    theme: 'light',
                    defaultLeverage: 10,
                    defaultAmount: 1000,
                    enableNotifications: true,
                    soundAlerts: false,
                    updateInterval: 60
                };
                saveSettings();
                applySettings();
                
                // Update form
                document.getElementById('theme-select').value = userSettings.theme;
                document.getElementById('default-leverage').value = userSettings.defaultLeverage;
                document.getElementById('default-amount').value = userSettings.defaultAmount;
                document.getElementById('enable-notifications').checked = userSettings.enableNotifications;
                document.getElementById('sound-alerts').checked = userSettings.soundAlerts;
                document.getElementById('update-interval').value = userSettings.updateInterval;
                
                showNotification('Settings reset to default!', 'info');
            }
        });
        
        // Modal close button
        document.querySelector('.close').addEventListener('click', function() {
            const modal = document.getElementById('trading-modal');
            modal.classList.remove('visible');
            setTimeout(() => modal.style.display = 'none', 300);
        });
        
        // Cancel button
        document.getElementById('cancel-trade').addEventListener('click', function() {
            const modal = document.getElementById('trading-modal');
            modal.classList.remove('visible');
            setTimeout(() => modal.style.display = 'none', 300);
        });
        
        // Execute trade button
        document.getElementById('execute-trade').addEventListener('click', executeTrade);
        
        // Trade amount input
        document.getElementById('trade-amount').addEventListener('input', updateTradeCalculations);
        
        // Trade leverage dropdown
        document.getElementById('trade-leverage').addEventListener('change', updateTradeCalculations);
        
        // Trade type toggle buttons
        document.querySelectorAll('.trade-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.trade-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                document.getElementById('trade-type').value = this.getAttribute('data-type');
                
                // Reset stop loss and take profit validation
                const stopLossInput = document.getElementById('stop-loss');
                const takeProfitInput = document.getElementById('take-profit');
                if (stopLossInput) stopLossInput.style.borderColor = '';
                if (takeProfitInput) takeProfitInput.style.borderColor = '';
                
                // Update calculations
                updateTradeCalculations();
            });
        });
        
        // Amount preset buttons
        document.querySelectorAll('.amount-presets button').forEach(btn => {
            btn.addEventListener('click', function() {
                const amount = this.getAttribute('data-amount');
                document.getElementById('trade-amount').value = amount;
                updateTradeCalculations();
            });
        });
        
        // Stop loss and take profit toggles
        document.getElementById('use-stop-loss').addEventListener('change', function() {
            const stopLossInput = document.getElementById('stop-loss');
            stopLossInput.disabled = !this.checked;
            if (this.checked) {
                stopLossInput.focus();
            }
        });
        
        document.getElementById('use-take-profit').addEventListener('change', function() {
            const takeProfitInput = document.getElementById('take-profit');
            takeProfitInput.disabled = !this.checked;
            if (this.checked) {
                takeProfitInput.focus();
            }
        });

        // Stop loss and take profit input validation
        document.getElementById('stop-loss').addEventListener('input', function() {
            const rate = parseFloat(document.getElementById('modal-rate').textContent);
            const tradeType = document.getElementById('trade-type').value;
            
            if (tradeType === 'buy') {
                // For buy orders, stop loss should be below current rate
                if (parseFloat(this.value) >= rate) {
                    this.style.borderColor = 'var(--danger-color)';
                    showNotification('Stop loss should be below current rate for buy orders', 'error');
                } else {
                    this.style.borderColor = 'var(--success-color)';
                }
            } else {
                // For sell orders, stop loss should be above current rate
                if (parseFloat(this.value) <= rate) {
                    this.style.borderColor = 'var(--danger-color)';
                    showNotification('Stop loss should be above current rate for sell orders', 'error');
                } else {
                    this.style.borderColor = 'var(--success-color)';
                }
            }
            updateTradeCalculations();
        });

        document.getElementById('take-profit').addEventListener('input', function() {
            const rate = parseFloat(document.getElementById('modal-rate').textContent);
            const tradeType = document.getElementById('trade-type').value;
            
            if (tradeType === 'buy') {
                // For buy orders, take profit should be above current rate
                if (parseFloat(this.value) <= rate) {
                    this.style.borderColor = 'var(--danger-color)';
                    showNotification('Take profit should be above current rate for buy orders', 'error');
                } else {
                    this.style.borderColor = 'var(--success-color)';
                }
            } else {
                // For sell orders, take profit should be below current rate
                if (parseFloat(this.value) >= rate) {
                    this.style.borderColor = 'var(--danger-color)';
                    showNotification('Take profit should be below current rate for sell orders', 'error');
                } else {
                    this.style.borderColor = 'var(--success-color)';
                }
            }
            updateTradeCalculations();
        });
        
        // Portfolio refresh button
        document.getElementById('refresh-portfolio').addEventListener('click', updateProfitLoss);
        
        // View toggle buttons
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const view = this.getAttribute('data-view');
                const forexContainer = document.getElementById('forex-pairs');
                
                if (view === 'list') {
                    forexContainer.classList.remove('forex-grid');
                    forexContainer.classList.add('forex-list');
                } else {
                    forexContainer.classList.remove('forex-list');
                    forexContainer.classList.add('forex-grid');
                }
            });
        });
        
        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const filter = this.getAttribute('data-filter');
                const positions = document.querySelectorAll('.position');
                
                positions.forEach(pos => {
                    const posType = pos.querySelector('.position-type').textContent.toLowerCase();
                    
                    if (filter === 'all' || posType === filter) {
                        pos.style.display = 'flex';
                    } else {
                        pos.style.display = 'none';
                    }
                });
            });
        });
    }

    // Simulate historical data for a currency pair
    function generateHistoricalData(baseValue, points = 30, volatility = 0.5) {
        const data = [];
        let value = baseValue;
        for (let i = 0; i < points; i++) {
            const change = (Math.random() - 0.5) * volatility;
            value = Math.max(0.0001, value + change);
            data.push(parseFloat(value.toFixed(4)));
        }
        return data;
    }

    // Render chart for selected pair and timeframe
    function renderMarketChart(pair, baseValue, timeframe = '1W') {
        const ctx = document.getElementById('market-chart').getContext('2d');
        let points = 30;
        let label = 'Last 7 Days';
        if (timeframe === '1D') { points = 24; label = 'Last 24 Hours'; }
        if (timeframe === '1M') { points = 30; label = 'Last 30 Days'; }
        const data = generateHistoricalData(baseValue, points);
        const labels = Array.from({length: points}, (_, i) => `${i+1}`);
        if (marketChart) marketChart.destroy();
        marketChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: `${pair} Price (${label})`,
                    data: data,
                    borderColor: '#2563eb',
                    backgroundColor: 'rgba(37,99,235,0.1)',
                    fill: true,
                    tension: 0.3,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: true }
                },
                scales: {
                    x: { display: false },
                    y: { beginAtZero: false }
                }
            }
        });
    }

    // Update chart when a pair is selected or timeframe changes
    document.addEventListener('DOMContentLoaded', function() {
        // Listen for pair selection
        document.addEventListener('click', function(e) {
            if (e.target.closest('.forex-pair')) {
                const pairDiv = e.target.closest('.forex-pair');
                const pairName = pairDiv.querySelector('h3').textContent;
                const rateValue = parseFloat(pairDiv.querySelector('.rate-value').textContent);
                selectedChartPair = pairName;
                selectedChartValue = rateValue;
                const timeframe = document.getElementById('timeframe').value;
                renderMarketChart(selectedChartPair, selectedChartValue, timeframe);
            }
        });
        // Listen for timeframe change
        document.getElementById('timeframe').addEventListener('change', function() {
            if (selectedChartPair) {
                renderMarketChart(selectedChartPair, selectedChartValue, this.value);
            }
        });
    });
</script>

<style>
/* Reset and base styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Inter', sans-serif;
}

:root {
    --primary-color: #2563eb;
    --primary-light: #3b82f6;
    --primary-dark: #1d4ed8;
    --secondary-color: #475569;
    --success-color: #10b981;
    --danger-color: #ef4444;
    --warning-color: #f59e0b;
    --info-color: #0ea5e9;
    --light-bg: #f8fafc;
    --dark-bg: #1e293b;
    --border-color: #e2e8f0;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --text-light: #94a3b8;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --card-bg: #ffffff;
    --header-height: 70px;
    --sidebar-width: 240px;
    --content-padding: 24px;
}

body {
    background: var(--light-bg);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

h1, h2, h3, h4, h5, h6 {
    font-weight: 600;
    line-height: 1.3;
    color: var(--text-primary);
}

button {
    cursor: pointer;
    font-weight: 500;
}

.positive {
    color: var(--success-color);
}

.negative {
    color: var(--danger-color);
}

.highlighted {
    font-weight: 600;
    color: var(--primary-color);
}

/* Header Styles */
.header {
    height: var(--header-height);
    background: var(--card-bg);
    box-shadow: var(--shadow-sm);
    display: flex;
    align-items: center;
    padding: 0 var(--content-padding);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
}

.logo {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
}

.logo i {
    font-size: 1.25rem;
}

.main-nav {
    margin-left: 40px;
    flex: 1;
}

.main-nav ul {
    display: flex;
    list-style: none;
    gap: 5px;
}

.main-nav a {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 15px;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: 6px;
    transition: all 0.2s ease;
}

.main-nav a:hover {
    background: var(--light-bg);
    color: var(--text-primary);
}

.main-nav li.active a {
    background: var(--primary-color);
    color: white;
}

.user-controls {
    display: flex;
    align-items: center;
    gap: 20px;
}

.notifications {
    position: relative;
    cursor: pointer;
}

.notifications i {
    font-size: 1.2rem;
    color: var(--text-secondary);
}

.settings-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--light-bg);
    cursor: pointer;
    transition: all 0.2s ease;
}

.settings-btn:hover {
    background: var(--border-color);
    transform: rotate(90deg);
}

.settings-btn i {
    font-size: 1.1rem;
    color: var(--text-secondary);
}

.settings-btn:hover i {
    color: var(--primary-color);
}

.badge {
    position: absolute;
    top: -6px;
    right: -6px;
    background: var(--danger-color);
    color: white;
    font-size: 0.7rem;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.user-profile {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 6px;
    transition: all 0.2s ease;
}

.user-profile:hover {
    background: var(--light-bg);
}

.avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
}

/* Main Container */
.main-container {
    display: flex;
    margin-top: var(--header-height);
    min-height: calc(100vh - var(--header-height));
}

/* Sidebar */
.sidebar {
    width: var(--sidebar-width);
    background: var(--card-bg);
    border-right: 1px solid var(--border-color);
    padding: 20px;
    position: fixed;
    top: var(--header-height);
    left: 0;
    bottom: 0;
    overflow-y: auto;
    z-index: 50;
}

.market-status {
    background: var(--light-bg);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
}

.status-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 10px;
}

.status-indicator.active {
    color: var(--success-color);
    font-weight: 500;
}

.pulse {
    width: 10px;
    height: 10px;
    background: var(--success-color);
    border-radius: 50%;
    display: inline-block;
    position: relative;
}

.pulse::after {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background: var(--success-color);
    border-radius: 50%;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% {
        transform: scale(1);
        opacity: 0.7;
    }
    70% {
        transform: scale(2);
        opacity: 0;
    }
    100% {
        transform: scale(1);
        opacity: 0;
    }
}

.time-info {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.current-time {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-primary);
}

.timezone {
    font-size: 0.8rem;
    color: var(--text-light);
}

.quick-links, .market-indices {
    margin-bottom: 25px;
}

.quick-links h4, .market-indices h4 {
    font-size: 0.9rem;
    color: var(--text-light);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
}

.quick-links ul {
    list-style: none;
}

.quick-links a {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    color: var(--text-primary);
    text-decoration: none;
    border-radius: 6px;
    transition: all 0.2s ease;
    font-size: 0.95rem;
}

.quick-links a:hover {
    background: var(--light-bg);
    color: var(--primary-color);
}

.market-indices .index-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid var(--border-color);
    font-size: 0.9rem;
}

.market-indices .index-item:last-child {
    border-bottom: none;
}

.index-item .value {
    font-weight: 600;
}

.index-item .value.up {
    color: var(--success-color);
}

.index-item .value.down {
    color: var(--danger-color);
}

/* Content Area */
.content-area {
    flex: 1;
    margin-left: var(--sidebar-width);
    padding: var(--content-padding);
}

/* Dashboard Header */
.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
}

.page-title h1 {
    font-size: 1.8rem;
    margin-bottom: 5px;
}

.subtitle {
    color: var(--text-secondary);
    font-size: 0.95rem;
}

/* Search Bar */
.search-container {
    max-width: 400px;
    width: 100%;
}

.search-wrapper {
    position: relative;
    width: 100%;
    display: flex;
    align-items: center;
}

.search-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-light);
}

#forex-search {
    width: 100%;
    padding: 10px 35px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    background: var(--card-bg);
    font-size: 0.95rem;
    transition: all 0.2s ease;
}

#forex-search:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.clear-search {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-light);
    display: none;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
}

.clear-search:hover {
    color: var(--text-primary);
}

/* Card Styles */
.card {
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: var(--shadow-sm);
    margin-bottom: 24px;
    border: 1px solid var(--border-color);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
}

.card-header h2 {
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.card-header h2 i {
    color: var(--primary-color);
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 15px;
}

.header-actions select {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    background: var(--card-bg);
    color: var(--text-primary);
    font-size: 0.9rem;
    cursor: pointer;
}

.refresh-button {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--light-bg);
    cursor: pointer;
    transition: all 0.2s ease;
}

.refresh-button:hover {
    background: var(--border-color);
}

.refresh-button.spinning i {
    animation: spin 1s linear;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.portfolio-time {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

/* Portfolio Styles */
.portfolio-summary {
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: var(--shadow-sm);
    margin-bottom: 24px;
    border: 1px solid var(--border-color);
    overflow: hidden;
}

.portfolio-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    padding: 20px;
}

.stat-card {
    background: var(--light-bg);
    padding: 20px;
    border-radius: 10px;
    display: flex;
    align-items: flex-start;
    gap: 15px;
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--primary-light);
    opacity: 0.5;
}

.main-balance::before {
    background: var(--success-color);
    opacity: 1;
}

.stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 10px;
    background: var(--primary-light);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
}

.main-balance .stat-icon {
    background: var(--success-color);
}

.stat-info {
    flex: 1;
}

.stat-label {
    display: block;
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 5px;
}

.stat-value {
    display: block;
    color: var(--text-primary);
    font-size: 1.6rem;
    font-weight: 700;
    margin-bottom: 5px;
}

.stat-value.positive {
    color: var(--success-color);
}

.stat-value.negative {
    color: var(--danger-color);
}

.stat-period {
    display: block;
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.stat-change {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 0.85rem;
    padding: 4px 8px;
    border-radius: 20px;
}

.stat-change.positive {
    background: rgba(16, 185, 129, 0.1);
}

.stat-change.negative {
    background: rgba(239, 68, 68, 0.1);
}

.stat-details {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 5px;
}

.mini-chart {
    display: flex;
    align-items: flex-end;
    gap: 3px;
    height: 20px;
}

.chart-bar {
    width: 4px;
    height: 100%;
    border-radius: 2px;
    background: var(--primary-light);
    transition: height 0.5s ease;
}

.chart-bar.positive {
    background: var(--success-color);
}

.chart-bar.negative {
    background: var(--danger-color);
}

.mini-stats {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    margin-top: 10px;
}

.mini-stat {
    display: flex;
    flex-direction: column;
}

.mini-label {
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.mini-value {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text-primary);
}

/* Trading Dashboard Grid */
.trading-dashboard-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
    margin-bottom: 24px;
}

@media (max-width: 1200px) {
    .trading-dashboard-grid {
        grid-template-columns: 1fr;
    }
}

/* Positions Styles */
.positions-container {
    padding-bottom: 20px;
}

.positions-filters {
    display: flex;
    gap: 10px;
}

.filter-btn {
    padding: 6px 12px;
    border-radius: 20px;
    background: var(--light-bg);
    border: 1px solid var(--border-color);
    color: var(--text-secondary);
    font-size: 0.85rem;
    transition: all 0.2s ease;
}

.filter-btn:hover {
    background: var(--border-color);
}

.filter-btn.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.positions-list {
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.position {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: var(--light-bg);
    border-radius: 10px;
    transition: all 0.2s ease;
}

.position:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.position-info {
    flex: 1;
}

.position-pair {
    margin-bottom: 10px;
}

.pair-name {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
}

.position-type {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-left: 8px;
}

.position-type.buy {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success-color);
}

.position-type.sell {
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger-color);
}

.position-details {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-top: 10px;
}

.detail {
    display: flex;
    flex-direction: column;
}

.detail-label {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.detail-value {
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--text-primary);
}

.position-pnl {
    font-size: 1.1rem;
    font-weight: 600;
    padding: 5px 10px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    gap: 5px;
}

.position-pnl.positive {
    background: rgba(16, 185, 129, 0.1);
}

.position-pnl.negative {
    background: rgba(239, 68, 68, 0.1);
}

.position-actions {
    margin-left: 15px;
}

.btn-outline-danger {
    padding: 6px 12px;
    background: transparent;
    border: 1px solid var(--danger-color);
    color: var(--danger-color);
    border-radius: 6px;
    font-size: 0.85rem;
    transition: all 0.2s ease;
}

.btn-outline-danger:hover {
    background: var(--danger-color);
    color: white;
}

.empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    text-align: center;
}

.empty-state i {
    font-size: 3rem;
    color: var(--text-light);
    margin-bottom: 15px;
}

.empty-state p {
    color: var(--text-secondary);
    margin-bottom: 20px;
}

.btn-primary {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: all 0.2s ease;
}

.btn-primary:hover {
    background: var(--primary-dark);
}

.btn-secondary {
    background: var(--light-bg);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: all 0.2s ease;
}

.btn-secondary:hover {
    background: var(--border-color);
}

/* Forex Pairs Styles */
.forex-container {
    padding-bottom: 20px;
}

.view-toggle {
    display: flex;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    overflow: hidden;
}

.view-btn {
    background: var(--light-bg);
    border: none;
    padding: 6px 12px;
    color: var(--text-secondary);
    transition: all 0.2s ease;
}

.view-btn.active {
    background: var(--primary-color);
    color: white;
}

.forex-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 15px;
    padding: 20px;
}

.forex-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 20px;
}

.forex-pair {
    background: var(--light-bg);
    padding: 15px;
    border-radius: 10px;
    border: 1px solid var(--border-color);
    transition: all 0.2s ease;
}

.forex-pair:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.pair-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
}

.pair-name {
    display: flex;
    flex-direction: column;
}

.pair-name h3 {
    font-size: 1.1rem;
    margin-bottom: 4px;
}

.pair-tag {
    display: inline-block;
    background: rgba(37, 99, 235, 0.1);
    color: var(--primary-color);
    font-size: 0.7rem;
    padding: 2px 8px;
    border-radius: 20px;
    font-weight: 500;
}

.pair-actions {
    display: flex;
    gap: 5px;
}

.btn-icon {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    color: var(--text-secondary);
    transition: all 0.2s ease;
}

.btn-icon:hover {
    background: var(--light-bg);
    color: var(--primary-color);
}

.pair-rate {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
}

.rate-value {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--text-primary);
}

.rate-change {
    display: flex;
    align-items: center;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 500;
    gap: 5px;
}

.trend-up {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success-color);
}

.trend-down {
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger-color);
}

.pair-stats {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    padding: 10px;
    background: var(--card-bg);
    border-radius: 8px;
}

.stat {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.stat-label {
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.stat-value {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-primary);
}

.trade-button {
    width: 100%;
    padding: 10px;
    border: none;
    background: var(--primary-color);
    color: white;
    border-radius: 6px;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.trade-button:hover {
    background: var(--primary-dark);
}

.empty-search {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 30px 20px;
    color: var(--text-secondary);
    text-align: center;
    grid-column: 1 / -1;
}

.empty-search i {
    font-size: 2rem;
    margin-bottom: 10px;
    opacity: 0.5;
}

/* Market Analysis Section */
.chart-container {
    padding: 20px;
    min-height: 300px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.chart-placeholder {
    width: 100%;
    height: 250px;
    background: var(--light-bg);
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
    overflow: hidden;
}

.chart-lines {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0.1;
}

.chart-line {
    position: absolute;
    width: 100%;
    height: 1px;
    background: var(--text-primary);
}

.chart-line:nth-child(1) {
    top: 20%;
}

.chart-line:nth-child(2) {
    top: 40%;
}

.chart-line:nth-child(3) {
    top: 60%;
}

.chart-line:nth-child(4) {
    top: 80%;
}

.chart-placeholder p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    text-align: center;
    max-width: 80%;
    z-index: 1;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(30, 41, 59, 0.7);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.modal.visible {
    opacity: 1;
}

.modal-content {
    width: 100%;
    max-width: 540px;
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    transform: translateY(20px);
    transition: transform 0.3s ease;
}

.modal.visible .modal-content {
    transform: translateY(0);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
}

.modal-header h3 {
    font-size: 1.25rem;
    font-weight: 600;
}

.close {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1.2rem;
    cursor: pointer;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
}

.close:hover {
    background: var(--light-bg);
    color: var(--text-primary);
}

.modal-body {
    padding: 20px;
}

.pair-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 15px;
    background: var(--light-bg);
    border-radius: 10px;
}

.pair-rate {
    display: flex;
    flex-direction: column;
}

#modal-rate {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
}

.bid-ask {
    display: flex;
    gap: 20px;
}

.bid, .ask {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-bottom: 5px;
}

.value {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
}

.trade-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.form-group label {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.trade-type-toggle {
    display: flex;
    width: 100%;
    border-radius: 6px;
    overflow: hidden;
    border: 1px solid var(--border-color);
}

.trade-btn {
    flex: 1;
    padding: 10px;
    border: none;
    background: var(--light-bg);
    font-weight: 500;
    transition: all 0.2s ease;
}

.trade-btn.buy.active {
    background: var(--success-color);
    color: white;
}

.trade-btn.sell.active {
    background: var(--danger-color);
    color: white;
}

input[type="number"], select {
    padding: 10px 12px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    background: var(--card-bg);
    font-size: 0.95rem;
    width: 100%;
}

input[type="number"]:focus, select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.amount-input {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.amount-presets {
    display: flex;
    gap: 8px;
}

.amount-presets button {
    flex: 1;
    padding: 6px 10px;
    background: var(--light-bg);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-size: 0.85rem;
    color: var(--text-primary);
    transition: all 0.2s ease;
}

.amount-presets button:hover {
    background: var(--border-color);
}

.order-details {
    background: var(--light-bg);
    padding: 15px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.detail-item {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
}

.detail-label {
    color: var(--text-secondary);
}

.detail-value {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text-primary);
}

.risk-management {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.risk-management .form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.risk-management label {
    display: flex;
    align-items: center;
    gap: 8px;
}

.modal-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-top: 1px solid var(--border-color);
    background: var(--light-bg);
}

.trade-summary {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
}

.action-buttons {
    display: flex;
    gap: 10px;
}

/* notification styles */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    background: var(--card-bg);
    border-radius: 8px;
    box-shadow: var(--shadow-lg);
    display: flex;
    align-items: center;
    gap: 12px;
    transform: translateX(120%);
    transition: transform 0.3s ease;
    z-index: 1000;
    max-width: 350px;
}

.notification.show {
    transform: translateX(0);
}

.notification i {
    font-size: 1.2rem;
}

.notification.info i {
    color: var(--info-color);
}

.notification.success i {
    color: var(--success-color);
}

.notification.error i {
    color: var(--danger-color);
}

.notification span {
    flex: 1;
    color: var(--text-primary);
    font-size: 0.95rem;
}

/* Responsive Adjustments */
@media (max-width: 1024px) {
    :root {
        --sidebar-width: 220px;
    }
    
    .trading-dashboard-grid {
        grid-template-columns: 1fr;
    }
    
    .portfolio-stats {
        grid-template-columns: 1fr 1fr;
    }
}

@media (max-width: 768px) {
    :root {
        --sidebar-width: 0;
        --content-padding: 15px;
    }
    
    .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    
    .sidebar.open {
        transform: translateX(0);
        width: 260px;
    }
    
    .content-area {
        margin-left: 0;
    }
    
    .main-nav {
        display: none;
    }
    
    .logo {
        margin-right: auto;
    }
    
    .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .search-container {
        width: 100%;
        max-width: 100%;
    }
    
    .portfolio-stats {
        grid-template-columns: 1fr;
    }
    
    .risk-management {
        grid-template-columns: 1fr;
    }
}

.settings-section {
    margin-bottom: 25px;
}

.settings-section h4 {
    font-size: 1rem;
    color: var(--text-primary);
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border-color);
}

.settings-section .form-group {
    margin-bottom: 15px;
}

.settings-section label {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.95rem;
    color: var(--text-primary);
    cursor: pointer;
}

.settings-section input[type="checkbox"] {
    width: auto;
    margin: 0;
}

.settings-section select,
.settings-section input[type="number"] {
    width: 100%;
    padding: 8px 12px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    background: var(--card-bg);
    font-size: 0.95rem;
}

.settings-section select:focus,
.settings-section input[type="number"]:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.trade-button {
    width: 100%;
    padding: 10px;
    border: none;
    background: var(--primary-color);
    color: white;
    border-radius: 6px;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.trade-button:hover {
    background: var(--primary-dark);
}

.pair-trading-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-top: 15px;
}

.pair-trading-buttons .trade-button.advanced {
    grid-column: 1 / -1;
    background: var(--secondary-color);
}

.pair-trading-buttons .trade-button.advanced:hover {
    background: var(--text-primary);
}

.pair-trading-buttons .trade-button.buy {
    background: var(--success-color);
}

.pair-trading-buttons .trade-button.buy:hover {
    background: #059669;
}

.pair-trading-buttons .trade-button.sell {
    background: var(--danger-color);
}

.pair-trading-buttons .trade-button.sell:hover {
    background: #dc2626;
}
</style>
</body>
</html>